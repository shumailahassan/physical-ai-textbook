"use strict";(globalThis.webpackChunkphysical_ai_textbook=globalThis.webpackChunkphysical_ai_textbook||[]).push([[3673],{3884(e,n,r){r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>s});const a=JSON.parse('{"id":"module-1-nodes-lifecycle","title":"Chapter 2 - Nodes and Lifecycle Management","description":"Node Creation in C++","source":"@site/docs/module-1-nodes-lifecycle.md","sourceDirName":".","slug":"/module-1-nodes-lifecycle","permalink":"/ur/docs/module-1-nodes-lifecycle","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-1-nodes-lifecycle.md","tags":[],"version":"current","frontMatter":{"id":"module-1-nodes-lifecycle","title":"Chapter 2 - Nodes and Lifecycle Management","sidebar_label":"Chapter 2 - Nodes and Lifecycle Management"},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 1 - ROS2 Architecture","permalink":"/ur/docs/module-1-ros2-architecture"},"next":{"title":"Chapter 3 - Topics and Message Passing","permalink":"/ur/docs/module-1-topics-message-passing"}}');var t=r(4848),c=r(8453);const i={id:"module-1-nodes-lifecycle",title:"Chapter 2 - Nodes and Lifecycle Management",sidebar_label:"Chapter 2 - Nodes and Lifecycle Management"},o="Chapter 2: Nodes and Lifecycle Management",l={},s=[{value:"Node Creation in C++",id:"node-creation-in-c",level:2},{value:"Basic Node Structure",id:"basic-node-structure",level:3},{value:"Node Parameters and Configuration",id:"node-parameters-and-configuration",level:3},{value:"Node Composition",id:"node-composition",level:3},{value:"Node Creation in Python",id:"node-creation-in-python",level:2},{value:"Basic Node Structure",id:"basic-node-structure-1",level:3},{value:"Async/Await Patterns in Python Nodes",id:"asyncawait-patterns-in-python-nodes",level:3},{value:"Node Lifecycle Management",id:"node-lifecycle-management",level:2},{value:"Lifecycle Node States",id:"lifecycle-node-states",level:3},{value:"Lifecycle Node Implementation in C++",id:"lifecycle-node-implementation-in-c",level:3},{value:"Lifecycle Node Implementation in Python",id:"lifecycle-node-implementation-in-python",level:3},{value:"Parameters and Configuration",id:"parameters-and-configuration",level:2},{value:"Parameter Server Functionality",id:"parameter-server-functionality",level:3},{value:"Dynamic Parameter Updates",id:"dynamic-parameter-updates",level:3},{value:"Best Practices for Node Development",id:"best-practices-for-node-development",level:2},{value:"Error Handling",id:"error-handling",level:3},{value:"Resource Management",id:"resource-management",level:3},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"chapter-2-nodes-and-lifecycle-management",children:"Chapter 2: Nodes and Lifecycle Management"})}),"\n",(0,t.jsx)(n.h2,{id:"node-creation-in-c",children:"Node Creation in C++"}),"\n",(0,t.jsxs)(n.p,{children:["In ROS2, a node serves as the fundamental building block of any robotic application. A node is an executable process that communicates with other nodes through topics, services, actions, and parameters. Creating a node in C++ involves inheriting from the ",(0,t.jsx)(n.code,{children:"rclcpp::Node"})," class and implementing the desired functionality."]}),"\n",(0,t.jsx)(n.h3,{id:"basic-node-structure",children:"Basic Node Structure"}),"\n",(0,t.jsx)(n.p,{children:"A basic ROS2 node in C++ follows this structure:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'#include <rclcpp/rclcpp.hpp>\r\n\r\nclass MyNode : public rclcpp::Node\r\n{\r\npublic:\r\n    MyNode() : Node("node_name")\r\n    {\r\n        // Initialize node components here\r\n    }\r\n\r\nprivate:\r\n    // Declare member variables for publishers, subscribers, etc.\r\n};\r\n\r\nint main(int argc, char * argv[])\r\n{\r\n    rclcpp::init(argc, argv);\r\n    rclcpp::spin(std::make_shared<MyNode>());\r\n    rclcpp::shutdown();\r\n    return 0;\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"node-parameters-and-configuration",children:"Node Parameters and Configuration"}),"\n",(0,t.jsx)(n.p,{children:"ROS2 nodes can declare and use parameters to make them configurable without recompilation. Parameters can be set at runtime through launch files, command-line arguments, or programmatically."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'// Declare a parameter with a default value\r\nthis->declare_parameter<std::string>("robot_name", "my_robot");\r\nthis->declare_parameter<double>("loop_rate", 10.0);\r\n\r\n// Get parameter value\r\nstd::string robot_name = this->get_parameter("robot_name").as_string();\r\ndouble loop_rate = this->get_parameter("loop_rate").as_double();\n'})}),"\n",(0,t.jsx)(n.h3,{id:"node-composition",children:"Node Composition"}),"\n",(0,t.jsx)(n.p,{children:"ROS2 supports node composition, allowing multiple nodes to run within the same process. This approach reduces communication overhead and can improve performance for tightly coupled components."}),"\n",(0,t.jsx)(n.h2,{id:"node-creation-in-python",children:"Node Creation in Python"}),"\n",(0,t.jsx)(n.p,{children:"Creating nodes in Python follows a similar pattern but with Python-specific syntax and conventions."}),"\n",(0,t.jsx)(n.h3,{id:"basic-node-structure-1",children:"Basic Node Structure"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass MyNode(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('node_name')\r\n        # Initialize node components here\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = MyNode()\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(n.h3,{id:"asyncawait-patterns-in-python-nodes",children:"Async/Await Patterns in Python Nodes"}),"\n",(0,t.jsx)(n.p,{children:"Python nodes can leverage async/await patterns for more efficient handling of concurrent operations:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nimport asyncio\r\n\r\nclass AsyncNode(Node):\r\n\r\n    def __init__(self):\r\n        super().__init__('async_node')\r\n\r\n    async def async_operation(self):\r\n        # Perform asynchronous operation\r\n        await asyncio.sleep(1.0)\r\n        self.get_logger().info('Async operation completed')\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = AsyncNode()\r\n\r\n    # Run async operations\r\n    loop = asyncio.get_event_loop()\r\n    loop.run_until_complete(node.async_operation())\r\n\r\n    rclpy.spin(node)\r\n    node.destroy_node()\r\n    rclpy.shutdown()\n"})}),"\n",(0,t.jsx)(n.h2,{id:"node-lifecycle-management",children:"Node Lifecycle Management"}),"\n",(0,t.jsx)(n.p,{children:"ROS2 introduces a sophisticated lifecycle management system that provides better control over node states and transitions. The lifecycle node concept addresses challenges in complex robotic systems where components need to be initialized, activated, deactivated, and cleaned up in a coordinated manner."}),"\n",(0,t.jsx)(n.h3,{id:"lifecycle-node-states",children:"Lifecycle Node States"}),"\n",(0,t.jsx)(n.p,{children:"The ROS2 lifecycle system defines several states that a node can occupy:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Unconfigured"}),": Initial state after node creation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Inactive"}),": Node is configured but not active"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Active"}),": Node is fully operational"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Finalized"}),": Node is shutting down"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"lifecycle-node-implementation-in-c",children:"Lifecycle Node Implementation in C++"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'#include <rclcpp/rclcpp.hpp>\r\n#include <rclcpp_lifecycle/lifecycle_node.hpp>\r\n#include <rclcpp_lifecycle/lifecycle_publisher.hpp>\r\n\r\nclass LifecycleNodeExample : public rclcpp_lifecycle::LifecycleNode\r\n{\r\npublic:\r\n    LifecycleNodeExample() : rclcpp_lifecycle::LifecycleNode("lifecycle_node")\r\n    {\r\n    }\r\n\r\n    rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn\r\n    on_configure(const rclcpp_lifecycle::State &)\r\n    {\r\n        RCLCPP_INFO(get_logger(), "Configuring node");\r\n        // Initialize resources but don\'t start processing\r\n        return rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn::SUCCESS;\r\n    }\r\n\r\n    rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn\r\n    on_activate(const rclcpp_lifecycle::State &)\r\n    {\r\n        RCLCPP_INFO(get_logger(), "Activating node");\r\n        // Start processing, activate publishers/subscribers\r\n        return rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn::SUCCESS;\r\n    }\r\n\r\n    rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn\r\n    on_deactivate(const rclcpp_lifecycle::State &)\r\n    {\r\n        RCLCPP_INFO(get_logger(), "Deactivating node");\r\n        // Stop processing, deactivate publishers/subscribers\r\n        return rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn::SUCCESS;\r\n    }\r\n\r\n    rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn\r\n    on_cleanup(const rclcpp_lifecycle::State &)\r\n    {\r\n        RCLCPP_INFO(get_logger(), "Cleaning up node");\r\n        // Release resources\r\n        return rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn::SUCCESS;\r\n    }\r\n\r\n    rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn\r\n    on_shutdown(const rclcpp_lifecycle::State &)\r\n    {\r\n        RCLCPP_INFO(get_logger(), "Shutting down node");\r\n        return rclcpp_lifecycle::node_interfaces::LifecycleNodeInterface::CallbackReturn::SUCCESS;\r\n    }\r\n};\n'})}),"\n",(0,t.jsx)(n.h3,{id:"lifecycle-node-implementation-in-python",children:"Lifecycle Node Implementation in Python"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.lifecycle import LifecycleNode, LifecycleState, TransitionCallbackReturn\r\nfrom rclpy.lifecycle import Publisher\r\nfrom std_msgs.msg import String\r\n\r\nclass LifecycleNodeExample(LifecycleNode):\r\n\r\n    def __init__(self):\r\n        super().__init__('lifecycle_node')\r\n        self.pub = None\r\n\r\n    def on_configure(self, state):\r\n        self.get_logger().info('Configuring node')\r\n        # Initialize resources but don't start processing\r\n        self.pub = self.create_publisher(String, 'topic', 10)\r\n        return TransitionCallbackReturn.SUCCESS\r\n\r\n    def on_activate(self, state):\r\n        self.get_logger().info('Activating node')\r\n        # Start processing, activate publishers/subscribers\r\n        self.pub.on_activate()\r\n        return TransitionCallbackReturn.SUCCESS\r\n\r\n    def on_deactivate(self, state):\r\n        self.get_logger().info('Deactivating node')\r\n        # Stop processing, deactivate publishers/subscribers\r\n        self.pub.on_deactivate()\r\n        return TransitionCallbackReturn.SUCCESS\r\n\r\n    def on_cleanup(self, state):\r\n        self.get_logger().info('Cleaning up node')\r\n        # Release resources\r\n        self.destroy_publisher(self.pub)\r\n        self.pub = None\r\n        return TransitionCallbackReturn.SUCCESS\r\n\r\n    def on_shutdown(self, state):\r\n        self.get_logger().info('Shutting down node')\r\n        return TransitionCallbackReturn.SUCCESS\n"})}),"\n",(0,t.jsx)(n.h2,{id:"parameters-and-configuration",children:"Parameters and Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"parameter-server-functionality",children:"Parameter Server Functionality"}),"\n",(0,t.jsx)(n.p,{children:"The ROS2 parameter server provides a centralized mechanism for managing node parameters. Parameters can be:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Declared at runtime with default values"}),"\n",(0,t.jsx)(n.li,{children:"Modified dynamically during execution"}),"\n",(0,t.jsx)(n.li,{children:"Loaded from YAML configuration files"}),"\n",(0,t.jsx)(n.li,{children:"Remapped using namespaces"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"dynamic-parameter-updates",children:"Dynamic Parameter Updates"}),"\n",(0,t.jsx)(n.p,{children:"Nodes can be configured to respond to parameter changes at runtime:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'// C++ example of parameter callback\r\nauto param_change_callback = [this](const std::vector<rclcpp::Parameter> &parameters) {\r\n    for (const auto &parameter : parameters) {\r\n        if (parameter.get_name() == "loop_rate") {\r\n            loop_rate_ = parameter.as_double();\r\n        }\r\n    }\r\n    return rclcpp_interfaces::msg::SetParametersResult();\r\n};\r\n\r\nthis->set_on_parameters_set_callback(param_change_callback);\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"# Python example of parameter callback\r\ndef parameter_callback(self, parameters):\r\n    for param in parameters:\r\n        if param.name == 'loop_rate':\r\n            self.loop_rate = param.value\r\n    return SetParametersResult(successful=True)\r\n\r\nself.set_parameters_callback(parameter_callback)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices-for-node-development",children:"Best Practices for Node Development"}),"\n",(0,t.jsx)(n.h3,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.p,{children:"Implement proper error handling in nodes to ensure robust operation:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'// C++ error handling example\r\ntry {\r\n    auto result = client_->async_send_request(request);\r\n    if (result.get()) {\r\n        RCLCPP_INFO(this->get_logger(), "Service call successful");\r\n    } else {\r\n        RCLCPP_ERROR(this->get_logger(), "Service call failed");\r\n    }\r\n} catch (const std::exception &e) {\r\n    RCLCPP_ERROR(this->get_logger(), "Exception during service call: %s", e.what());\r\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"resource-management",children:"Resource Management"}),"\n",(0,t.jsx)(n.p,{children:"Properly manage resources to prevent memory leaks and ensure clean shutdown:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Always destroy publishers, subscribers, and clients in the node destructor"}),"\n",(0,t.jsx)(n.li,{children:"Use smart pointers where appropriate"}),"\n",(0,t.jsx)(n.li,{children:"Implement proper cleanup in lifecycle nodes"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,t.jsx)(n.p,{children:"Node creation and lifecycle management form the foundation of ROS2 applications. Understanding these concepts is crucial for developing robust, maintainable robotic systems. The lifecycle node pattern provides enhanced control over node states, making it particularly valuable for complex robotic applications where coordinated initialization and shutdown procedures are essential."}),"\n",(0,t.jsx)(n.p,{children:"The choice between basic nodes and lifecycle nodes depends on the complexity of your application and the level of control required over the node's state transitions. For simple applications, basic nodes may suffice, but for production systems, lifecycle nodes provide better management capabilities."})]})}function p(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>i,x:()=>o});var a=r(6540);const t={},c=a.createContext(t);function i(e){const n=a.useContext(c);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),a.createElement(c.Provider,{value:n},e.children)}}}]);