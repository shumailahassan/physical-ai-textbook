"use strict";(globalThis.webpackChunkphysical_ai_textbook=globalThis.webpackChunkphysical_ai_textbook||[]).push([[1580],{5526(n,r,e){e.r(r),e.d(r,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"module-2-ros2-integration","title":"Chapter 7 - Integration with ROS2","description":"ROS2-Gazebo Bridge","source":"@site/docs/module-2-ros2-integration.md","sourceDirName":".","slug":"/module-2-ros2-integration","permalink":"/docs/module-2-ros2-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module-2-ros2-integration.md","tags":[],"version":"current","frontMatter":{"id":"module-2-ros2-integration","title":"Chapter 7 - Integration with ROS2","sidebar_label":"Chapter 7 - Integration with ROS2"},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 6 - Virtual Testing and Validation","permalink":"/docs/module-2-virtual-testing"},"next":{"title":"Chapter 8 - Exercises and Assignments","permalink":"/docs/module-2-exercises-assignments"}}');var o=e(4848),i=e(8453);const a={id:"module-2-ros2-integration",title:"Chapter 7 - Integration with ROS2",sidebar_label:"Chapter 7 - Integration with ROS2"},s="Chapter 7: Integration with ROS2",l={},c=[{value:"ROS2-Gazebo Bridge",id:"ros2-gazebo-bridge",level:2},{value:"ROS2-Gazebo Integration Architecture",id:"ros2-gazebo-integration-architecture",level:3},{value:"gazebo_ros_pkgs and Available Plugins",id:"gazebo_ros_pkgs-and-available-plugins",level:3},{value:"Core Plugins",id:"core-plugins",level:4},{value:"Communication Protocols and Message Types",id:"communication-protocols-and-message-types",level:3},{value:"Best Practices for Integration",id:"best-practices-for-integration",level:3},{value:"ROS2-Unity Bridge",id:"ros2-unity-bridge",level:2},{value:"ROS2-Unity Integration Approaches",id:"ros2-unity-integration-approaches",level:3},{value:"Available Unity-ROS2 Packages",id:"available-unity-ros2-packages",level:3},{value:"ROS TCP Connector Setup",id:"ros-tcp-connector-setup",level:4},{value:"Communication Protocols and Message Types",id:"communication-protocols-and-message-types-1",level:3},{value:"Best Practices for Unity-ROS2 Integration",id:"best-practices-for-unity-ros2-integration",level:3},{value:"Sensor Integration with ROS2",id:"sensor-integration-with-ros2",level:2},{value:"Connecting Simulated Sensors to ROS2",id:"connecting-simulated-sensors-to-ros2",level:3},{value:"Gazebo Sensor Integration",id:"gazebo-sensor-integration",level:4},{value:"Unity Sensor Integration",id:"unity-sensor-integration",level:4},{value:"Message Publishing from Simulation",id:"message-publishing-from-simulation",level:3},{value:"Control Integration with ROS2",id:"control-integration-with-ros2",level:2},{value:"Sending Control Commands to Simulation",id:"sending-control-commands-to-simulation",level:3},{value:"Gazebo Control Integration",id:"gazebo-control-integration",level:4},{value:"Control Node Implementation",id:"control-node-implementation",level:4},{value:"Unity Control Integration",id:"unity-control-integration",level:4},{value:"Safety and Error Handling",id:"safety-and-error-handling",level:2},{value:"Conclusion",id:"conclusion",level:2}];function m(n){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsx)(r.h1,{id:"chapter-7-integration-with-ros2",children:"Chapter 7: Integration with ROS2"})}),"\n",(0,o.jsx)(r.h2,{id:"ros2-gazebo-bridge",children:"ROS2-Gazebo Bridge"}),"\n",(0,o.jsx)(r.p,{children:"The integration between ROS2 and Gazebo forms the backbone of many robotics simulation workflows. This bridge enables seamless communication between the ROS2 middleware and the Gazebo physics simulator, allowing for sophisticated robot simulation and control."}),"\n",(0,o.jsx)(r.h3,{id:"ros2-gazebo-integration-architecture",children:"ROS2-Gazebo Integration Architecture"}),"\n",(0,o.jsxs)(r.p,{children:["The ROS2-Gazebo integration relies on the ",(0,o.jsx)(r.code,{children:"gazebo_ros_pkgs"})," package, which provides plugins and launch files to connect the two systems. The architecture consists of:"]}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Gazebo Server"}),": Handles physics simulation and sensor data generation"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Gazebo Client"}),": Provides visualization interface"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"ROS2 Bridge"}),": Facilitates communication between Gazebo and ROS2"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"ROS2 Nodes"}),": Handle robot control, perception, and other high-level tasks"]}),"\n"]}),"\n",(0,o.jsx)(r.h3,{id:"gazebo_ros_pkgs-and-available-plugins",children:"gazebo_ros_pkgs and Available Plugins"}),"\n",(0,o.jsxs)(r.p,{children:["The ",(0,o.jsx)(r.code,{children:"gazebo_ros_pkgs"})," package provides essential plugins for ROS2-Gazebo integration:"]}),"\n",(0,o.jsx)(r.h4,{id:"core-plugins",children:"Core Plugins"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-xml",children:'\x3c!-- Example: Complete robot configuration with ROS2 integration --\x3e\r\n<robot name="humanoid_robot" xmlns:xacro="http://www.ros.org/wiki/xacro">\r\n\r\n  \x3c!-- Include ROS2 control plugin --\x3e\r\n  <gazebo>\r\n    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">\r\n      <robotNamespace>/humanoid_robot</robotNamespace>\r\n      <robotSimType>gazebo_ros_control/DefaultRobotHWSim</robotSimType>\r\n    </plugin>\r\n  </gazebo>\r\n\r\n  \x3c!-- Joint state publisher plugin --\x3e\r\n  <gazebo>\r\n    <plugin name="joint_state_publisher" filename="libgazebo_ros_joint_state_publisher.so">\r\n      <update_rate>30</update_rate>\r\n      <joint_name>hip_joint</joint_name>\r\n      <joint_name>knee_joint</joint_name>\r\n      <joint_name>ankle_joint</joint_name>\r\n    </plugin>\r\n  </gazebo>\r\n\r\n  \x3c!-- Diff drive controller plugin (for wheeled robots) --\x3e\r\n  <gazebo>\r\n    <plugin name="diff_drive_controller" filename="libgazebo_ros_diff_drive.so">\r\n      <commandTopic>cmd_vel</commandTopic>\r\n      <odometryTopic>odom</odometryTopic>\r\n      <odometryFrame>odom</odometryFrame>\r\n      <robotBaseFrame>base_link</robotBaseFrame>\r\n      <updateRate>30</updateRate>\r\n      <leftJoint>left_wheel_joint</leftJoint>\r\n      <rightJoint>right_wheel_joint</rightJoint>\r\n      <wheelSeparation>0.3</wheelSeparation>\r\n      <wheelDiameter>0.15</wheelDiameter>\r\n    </plugin>\r\n  </gazebo>\r\n\r\n  \x3c!-- Joint trajectory controller --\x3e\r\n  <gazebo>\r\n    <plugin name="joint_trajectory_controller" filename="libgazebo_ros_joint_trajectory.so">\r\n      <robotNamespace>/humanoid_robot</robotNamespace>\r\n      <topicName>joint_trajectory</topicName>\r\n      <updateRate>100</updateRate>\r\n    </plugin>\r\n  </gazebo>\r\n\r\n</robot>\n'})}),"\n",(0,o.jsx)(r.h3,{id:"communication-protocols-and-message-types",children:"Communication Protocols and Message Types"}),"\n",(0,o.jsx)(r.p,{children:"The ROS2-Gazebo bridge uses standard ROS2 message types for communication:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-cpp",children:'// Example: ROS2 node for controlling a simulated humanoid robot in Gazebo\r\n#include <rclcpp/rclcpp.hpp>\r\n#include <sensor_msgs/msg/joint_state.hpp>\r\n#include <geometry_msgs/msg/twist.hpp>\r\n#include <trajectory_msgs/msg/joint_trajectory.hpp>\r\n#include <control_msgs/msg/joint_trajectory_controller_state.hpp>\r\n\r\nclass GazeboRobotController : public rclcpp::Node\r\n{\r\npublic:\r\n    GazeboRobotController()\r\n    : Node("gazebo_robot_controller")\r\n    {\r\n        // Subscribe to joint states from Gazebo\r\n        joint_state_sub_ = this->create_subscription<sensor_msgs::msg::JointState>(\r\n            "/joint_states", 10,\r\n            std::bind(&GazeboRobotController::jointStateCallback, this, std::placeholders::_1));\r\n\r\n        // Publisher for joint commands\r\n        joint_cmd_pub_ = this->create_publisher<trajectory_msgs::msg::JointTrajectory>(\r\n            "/joint_trajectory", 10);\r\n\r\n        // Publisher for velocity commands\r\n        cmd_vel_pub_ = this->create_publisher<geometry_msgs::msg::Twist>(\r\n            "/cmd_vel", 10);\r\n\r\n        // Timer for control loop\r\n        control_timer_ = this->create_wall_timer(\r\n            std::chrono::milliseconds(10), // 100 Hz\r\n            std::bind(&GazeboRobotController::controlLoop, this));\r\n    }\r\n\r\nprivate:\r\n    void jointStateCallback(const sensor_msgs::msg::JointState::SharedPtr msg)\r\n    {\r\n        // Store current joint states\r\n        current_joint_states_ = *msg;\r\n\r\n        RCLCPP_INFO_THROTTLE(this->get_logger(), *this->get_clock(), 1000,\r\n            "Received joint states: %zu joints", msg->name.size());\r\n    }\r\n\r\n    void controlLoop()\r\n    {\r\n        // Implement control logic based on current state\r\n        if (!current_joint_states_.name.empty()) {\r\n            // Example: Send a simple joint trajectory\r\n            sendJointTrajectoryCommand();\r\n        }\r\n    }\r\n\r\n    void sendJointTrajectoryCommand()\r\n    {\r\n        auto trajectory_msg = trajectory_msgs::msg::JointTrajectory();\r\n        trajectory_msg.joint_names = {"hip_joint", "knee_joint", "ankle_joint"};\r\n\r\n        trajectory_msgs::msg::JointTrajectoryPoint point;\r\n        point.positions = {0.1, -0.5, 0.2};  // Desired joint positions\r\n        point.velocities = {0.0, 0.0, 0.0};  // Desired joint velocities\r\n        point.time_from_start = rclcpp::Duration::from_seconds(0.1);\r\n\r\n        trajectory_msg.points.push_back(point);\r\n\r\n        joint_cmd_pub_->publish(trajectory_msg);\r\n    }\r\n\r\n    rclcpp::Subscription<sensor_msgs::msg::JointState>::SharedPtr joint_state_sub_;\r\n    rclcpp::Publisher<trajectory_msgs::msg::JointTrajectory>::SharedPtr joint_cmd_pub_;\r\n    rclcpp::Publisher<geometry_msgs::msg::Twist>::SharedPtr cmd_vel_pub_;\r\n    rclcpp::TimerBase::SharedPtr control_timer_;\r\n\r\n    sensor_msgs::msg::JointState current_joint_states_;\r\n};\r\n\r\nint main(int argc, char * argv[])\r\n{\r\n    rclcpp::init(argc, argv);\r\n    rclcpp::spin(std::make_shared<GazeboRobotController>());\r\n    rclcpp::shutdown();\r\n    return 0;\r\n}\n'})}),"\n",(0,o.jsx)(r.h3,{id:"best-practices-for-integration",children:"Best Practices for Integration"}),"\n",(0,o.jsx)(r.p,{children:"When integrating ROS2 with Gazebo, consider these best practices:"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Proper Namespace Management"}),": Use consistent namespaces across all topics and parameters"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Update Rate Optimization"}),": Balance simulation accuracy with computational efficiency"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Error Handling"}),": Implement robust error handling for connection issues"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Resource Management"}),": Monitor CPU and memory usage during simulation"]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"ros2-unity-bridge",children:"ROS2-Unity Bridge"}),"\n",(0,o.jsx)(r.p,{children:"The integration between ROS2 and Unity enables sophisticated simulation environments with high-quality graphics and physics. This bridge is typically achieved using the Unity ROS TCP Connector package."}),"\n",(0,o.jsx)(r.h3,{id:"ros2-unity-integration-approaches",children:"ROS2-Unity Integration Approaches"}),"\n",(0,o.jsx)(r.p,{children:"The Unity-ROS2 bridge is primarily implemented through the Unity Robotics Hub, which includes:"}),"\n",(0,o.jsxs)(r.ul,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"ROS TCP Connector"}),": Enables communication between Unity and ROS2 via TCP"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"URDF Importer"}),": Allows direct import of ROS robot models into Unity"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Message Packages"}),": Support for common ROS message types in Unity"]}),"\n"]}),"\n",(0,o.jsx)(r.h3,{id:"available-unity-ros2-packages",children:"Available Unity-ROS2 Packages"}),"\n",(0,o.jsx)(r.h4,{id:"ros-tcp-connector-setup",children:"ROS TCP Connector Setup"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-csharp",children:'// Example: Unity ROS2 bridge setup\r\nusing UnityEngine;\r\nusing Unity.Robotics.ROSTCPConnector;\r\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Std;\r\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor;\r\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Geometry;\r\n\r\npublic class UnityRobotController : MonoBehaviour\r\n{\r\n    [Header("ROS2 Configuration")]\r\n    public string rosIpAddress = "127.0.0.1";\r\n    public int rosPort = 10000;\r\n\r\n    [Header("Robot Topics")]\r\n    public string jointStateTopic = "/joint_states";\r\n    public string cmdVelTopic = "/cmd_vel";\r\n    public string trajectoryTopic = "/joint_trajectory";\r\n\r\n    private ROSConnection ros;\r\n    private bool isConnected = false;\r\n\r\n    void Start()\r\n    {\r\n        // Connect to ROS2\r\n        ros = ROSConnection.GetOrCreateInstance();\r\n        ros.Initialize(rosIpAddress, rosPort);\r\n\r\n        // Subscribe to topics\r\n        ros.Subscribe<JointStateMsg>(jointStateTopic, OnJointStateReceived);\r\n\r\n        // Connection status check\r\n        InvokeRepeating("CheckConnection", 1.0f, 5.0f);\r\n    }\r\n\r\n    void CheckConnection()\r\n    {\r\n        if (ros != null && ros.IsConnected())\r\n        {\r\n            isConnected = true;\r\n            Debug.Log("Connected to ROS2");\r\n        }\r\n        else\r\n        {\r\n            isConnected = false;\r\n            Debug.LogWarning("Not connected to ROS2");\r\n        }\r\n    }\r\n\r\n    void OnJointStateReceived(JointStateMsg jointState)\r\n    {\r\n        // Process joint state data\r\n        Debug.Log($"Received joint state with {jointState.name.Length} joints");\r\n\r\n        // Update Unity robot model based on joint positions\r\n        UpdateRobotModel(jointState);\r\n    }\r\n\r\n    void UpdateRobotModel(JointStateMsg jointState)\r\n    {\r\n        // Update each joint in the Unity robot model\r\n        for (int i = 0; i < jointState.name.Length && i < jointState.position.Length; i++)\r\n        {\r\n            string jointName = jointState.name[i];\r\n            float jointPosition = jointState.position[i];\r\n\r\n            // Find and update the corresponding joint in Unity\r\n            Transform jointTransform = FindJointByName(jointName);\r\n            if (jointTransform != null)\r\n            {\r\n                // Apply rotation based on joint type\r\n                jointTransform.localRotation = Quaternion.Euler(0, 0, jointPosition * Mathf.Rad2Deg);\r\n            }\r\n        }\r\n    }\r\n\r\n    Transform FindJointByName(string name)\r\n    {\r\n        // Find joint by name in the robot hierarchy\r\n        Transform[] allChildren = GetComponentsInChildren<Transform>();\r\n        foreach (Transform child in allChildren)\r\n        {\r\n            if (child.name == name)\r\n                return child;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public void SendVelocityCommand(float linearX, float angularZ)\r\n    {\r\n        if (!isConnected) return;\r\n\r\n        var twistMsg = new TwistMsg\r\n        {\r\n            linear = new Vector3Msg { x = linearX, y = 0, z = 0 },\r\n            angular = new Vector3Msg { x = 0, y = 0, z = angularZ }\r\n        };\r\n\r\n        ros.Publish(cmdVelTopic, twistMsg);\r\n    }\r\n\r\n    public void SendJointTrajectory(string[] jointNames, float[] positions, float[] velocities)\r\n    {\r\n        if (!isConnected) return;\r\n\r\n        var trajectoryMsg = new JointTrajectoryMsg\r\n        {\r\n            joint_names = jointNames,\r\n            points = new JointTrajectoryPointMsg[1]\r\n        };\r\n\r\n        trajectoryMsg.points[0] = new JointTrajectoryPointMsg\r\n        {\r\n            positions = positions,\r\n            velocities = velocities,\r\n            time_from_start = new DurationMsg { sec = 1, nanosec = 0 }\r\n        };\r\n\r\n        ros.Publish(trajectoryTopic, trajectoryMsg);\r\n    }\r\n}\n'})}),"\n",(0,o.jsx)(r.h3,{id:"communication-protocols-and-message-types-1",children:"Communication Protocols and Message Types"}),"\n",(0,o.jsx)(r.p,{children:"Unity-ROS2 communication follows standard ROS2 message types but uses TCP-based transport:"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-csharp",children:'// Example: Custom ROS2 message handler for Unity\r\nusing System;\r\nusing Unity.Robotics.ROSTCPConnector;\r\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Std;\r\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor;\r\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Geometry;\r\n\r\npublic class UnitySensorManager : MonoBehaviour\r\n{\r\n    [Header("Sensor Topics")]\r\n    public string imuTopic = "/imu/data";\r\n    public string laserScanTopic = "/scan";\r\n    public string cameraTopic = "/camera/image_raw";\r\n\r\n    private ROSConnection ros;\r\n\r\n    void Start()\r\n    {\r\n        ros = ROSConnection.GetOrCreateInstance();\r\n\r\n        // Subscribe to sensor topics\r\n        ros.Subscribe<ImuMsg>(imuTopic, OnImuDataReceived);\r\n        ros.Subscribe<LaserScanMsg>(laserScanTopic, OnLaserScanReceived);\r\n        ros.Subscribe<ImageMsg>(cameraTopic, OnCameraReceived);\r\n    }\r\n\r\n    void OnImuDataReceived(ImuMsg imuData)\r\n    {\r\n        // Process IMU data\r\n        Vector3 orientation = new Vector3(\r\n            (float)imuData.orientation.x,\r\n            (float)imuData.orientation.y,\r\n            (float)imuData.orientation.z\r\n        );\r\n\r\n        // Update Unity object orientation based on IMU data\r\n        transform.rotation = Quaternion.Euler(orientation);\r\n    }\r\n\r\n    void OnLaserScanReceived(LaserScanMsg laserScan)\r\n    {\r\n        // Process laser scan data for visualization or collision detection\r\n        float[] ranges = laserScan.ranges;\r\n\r\n        // Example: Create visualization of laser scan\r\n        VisualizeLaserScan(ranges, laserScan.angle_min, laserScan.angle_increment);\r\n    }\r\n\r\n    void VisualizeLaserScan(float[] ranges, float angleMin, float angleIncrement)\r\n    {\r\n        // Create visualization of laser scan points\r\n        for (int i = 0; i < ranges.Length; i++)\r\n        {\r\n            float angle = angleMin + (i * angleIncrement);\r\n            float distance = ranges[i];\r\n\r\n            if (distance > laserScan.range_min && distance < laserScan.range_max)\r\n            {\r\n                Vector3 point = new Vector3(\r\n                    distance * Mathf.Cos(angle),\r\n                    0,\r\n                    distance * Mathf.Sin(angle)\r\n                );\r\n\r\n                // Visualize the point (e.g., with a small sphere)\r\n                // Instantiate visualization prefab at \'point\'\r\n            }\r\n        }\r\n    }\r\n\r\n    void OnCameraReceived(ImageMsg imageData)\r\n    {\r\n        // Process camera image data\r\n        // This would typically involve updating a Unity texture with the image data\r\n        UpdateCameraTexture(imageData);\r\n    }\r\n\r\n    void UpdateCameraTexture(ImageMsg imageMsg)\r\n    {\r\n        // Convert ROS image message to Unity texture\r\n        // Implementation would depend on image format and requirements\r\n    }\r\n}\n'})}),"\n",(0,o.jsx)(r.h3,{id:"best-practices-for-unity-ros2-integration",children:"Best Practices for Unity-ROS2 Integration"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Performance Optimization"}),": Use appropriate update rates to balance real-time performance with simulation accuracy"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Network Configuration"}),": Ensure proper network setup for reliable TCP communication"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Message Serialization"}),": Optimize message sizes for efficient transmission"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Error Handling"}),": Implement robust connection management and reconnection logic"]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"sensor-integration-with-ros2",children:"Sensor Integration with ROS2"}),"\n",(0,o.jsx)(r.p,{children:"Integrating simulated sensors with ROS2 involves publishing sensor data to appropriate ROS2 topics and ensuring proper message formats."}),"\n",(0,o.jsx)(r.h3,{id:"connecting-simulated-sensors-to-ros2",children:"Connecting Simulated Sensors to ROS2"}),"\n",(0,o.jsx)(r.h4,{id:"gazebo-sensor-integration",children:"Gazebo Sensor Integration"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-xml",children:'\x3c!-- Example: Complete sensor configuration for ROS2 integration --\x3e\r\n\x3c!-- IMU Sensor --\x3e\r\n<gazebo reference="imu_link">\r\n  <sensor name="imu_sensor" type="imu">\r\n    <always_on>true</always_on>\r\n    <update_rate>100</update_rate>\r\n    <plugin name="imu_plugin" filename="libgazebo_ros_imu.so">\r\n      <topicName>/imu/data</topicName>\r\n      <bodyName>imu_link</bodyName>\r\n      <serviceName>/imu/service</serviceName>\r\n      <gaussianNoise>0.0017</gaussianNoise>\r\n      <updateRateHZ>100.0</updateRateHZ>\r\n      <frameName>imu_link</frameName>\r\n    </plugin>\r\n  </sensor>\r\n</gazebo>\r\n\r\n\x3c!-- Camera Sensor --\x3e\r\n<gazebo reference="camera_link">\r\n  <sensor name="camera" type="camera">\r\n    <update_rate>30</update_rate>\r\n    <camera>\r\n      <horizontal_fov>1.047</horizontal_fov>\r\n      <image>\r\n        <width>640</width>\r\n        <height>480</height>\r\n        <format>R8G8B8</format>\r\n      </image>\r\n      <clip>\r\n        <near>0.1</near>\r\n        <far>100</far>\r\n      </clip>\r\n    </camera>\r\n    <plugin name="camera_controller" filename="libgazebo_ros_camera.so">\r\n      <alwaysOn>true</alwaysOn>\r\n      <updateRate>30.0</updateRate>\r\n      <cameraName>camera</cameraName>\r\n      <imageTopicName>/camera/image_raw</imageTopicName>\r\n      <cameraInfoTopicName>/camera/camera_info</cameraInfoTopicName>\r\n      <frameName>camera_link</frameName>\r\n      <hackBaseline>0.07</hackBaseline>\r\n      <distortionK1>0.0</distortionK1>\r\n      <distortionK2>0.0</distortionK2>\r\n      <distortionK3>0.0</distortionK3>\r\n      <distortionT1>0.0</distortionT1>\r\n      <distortionT2>0.0</distortionT2>\r\n    </plugin>\r\n  </sensor>\r\n</gazebo>\r\n\r\n\x3c!-- LIDAR Sensor --\x3e\r\n<gazebo reference="lidar_link">\r\n  <sensor name="lidar_2d" type="ray">\r\n    <ray>\r\n      <scan>\r\n        <horizontal>\r\n          <samples>720</samples>\r\n          <resolution>1</resolution>\r\n          <min_angle>-3.14159</min_angle>\r\n          <max_angle>3.14159</max_angle>\r\n        </horizontal>\r\n      </scan>\r\n      <range>\r\n        <min>0.1</min>\r\n        <max>30.0</max>\r\n        <resolution>0.01</resolution>\r\n      </range>\r\n    </ray>\r\n    <plugin name="lidar_controller" filename="libgazebo_ros_laser.so">\r\n      <topicName>/scan</topicName>\r\n      <frameName>lidar_link</frameName>\r\n      <minRange>0.1</minRange>\r\n      <maxRange>30.0</maxRange>\r\n      <updateRate>10.0</updateRate>\r\n    </plugin>\r\n  </sensor>\r\n</gazebo>\n'})}),"\n",(0,o.jsx)(r.h4,{id:"unity-sensor-integration",children:"Unity Sensor Integration"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-csharp",children:'// Example: Unity sensor data publisher for ROS2\r\nusing UnityEngine;\r\nusing Unity.Robotics.ROSTCPConnector;\r\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor;\r\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Geometry;\r\n\r\npublic class UnitySensorPublisher : MonoBehaviour\r\n{\r\n    [Header("Sensor Configuration")]\r\n    public float updateRate = 30.0f;\r\n\r\n    [Header("ROS2 Topics")]\r\n    public string jointStatesTopic = "/joint_states";\r\n    public string imuTopic = "/imu/data";\r\n    public string laserScanTopic = "/scan";\r\n\r\n    private ROSConnection ros;\r\n    private float nextUpdateTime;\r\n    private JointStateMsg jointStateMsg;\r\n\r\n    void Start()\r\n    {\r\n        ros = ROSConnection.GetOrCreateInstance();\r\n        nextUpdateTime = Time.time;\r\n\r\n        InitializeJointStateMessage();\r\n    }\r\n\r\n    void InitializeJointStateMessage()\r\n    {\r\n        // Find all joints in the robot\r\n        var jointComponents = GetComponentsInChildren<HumanoidJoint>();\r\n\r\n        jointStateMsg = new JointStateMsg();\r\n        jointStateMsg.name = new string[jointComponents.Length];\r\n        jointStateMsg.position = new double[jointComponents.Length];\r\n        jointStateMsg.velocity = new double[jointComponents.Length];\r\n        jointStateMsg.effort = new double[jointComponents.Length];\r\n\r\n        for (int i = 0; i < jointComponents.Length; i++)\r\n        {\r\n            jointStateMsg.name[i] = jointComponents[i].jointName;\r\n        }\r\n    }\r\n\r\n    void Update()\r\n    {\r\n        if (Time.time >= nextUpdateTime)\r\n        {\r\n            PublishSensorData();\r\n            nextUpdateTime = Time.time + (1.0f / updateRate);\r\n        }\r\n    }\r\n\r\n    void PublishSensorData()\r\n    {\r\n        // Publish joint states\r\n        UpdateJointStates();\r\n        ros.Publish(jointStatesTopic, jointStateMsg);\r\n\r\n        // Publish IMU data if available\r\n        var imuComponent = GetComponent<UnityIMUSensor>();\r\n        if (imuComponent != null)\r\n        {\r\n            var imuData = imuComponent.GetIMUData();\r\n            ros.Publish(imuTopic, imuData);\r\n        }\r\n\r\n        // Publish LIDAR data if available\r\n        var lidarComponent = GetComponent<UnityLIDARSensor>();\r\n        if (lidarComponent != null)\r\n        {\r\n            var lidarData = lidarComponent.GetLIDARData();\r\n            ros.Publish(laserScanTopic, lidarData);\r\n        }\r\n    }\r\n\r\n    void UpdateJointStates()\r\n    {\r\n        var jointComponents = GetComponentsInChildren<HumanoidJoint>();\r\n\r\n        for (int i = 0; i < jointComponents.Length && i < jointStateMsg.name.Length; i++)\r\n        {\r\n            jointStateMsg.position[i] = jointComponents[i].GetCurrentAngle();\r\n            jointStateMsg.velocity[i] = jointComponents[i].GetCurrentVelocity();\r\n            jointStateMsg.effort[i] = jointComponents[i].GetCurrentEffort();\r\n        }\r\n\r\n        // Set timestamp\r\n        jointStateMsg.header = new HeaderMsg\r\n        {\r\n            stamp = new TimeMsg\r\n            {\r\n                sec = (int)Time.time,\r\n                nanosec = (uint)((Time.time - Mathf.Floor(Time.time)) * 1e9f)\r\n            },\r\n            frame_id = "base_link"\r\n        };\r\n    }\r\n}\r\n\r\n// Helper component for individual joints\r\npublic class HumanoidJoint : MonoBehaviour\r\n{\r\n    public string jointName;\r\n    public JointType jointType;\r\n    public float minAngle = -90f;\r\n    public float maxAngle = 90f;\r\n\r\n    private float currentAngle = 0f;\r\n    private float currentVelocity = 0f;\r\n    private float currentEffort = 0f;\r\n\r\n    public float GetCurrentAngle()\r\n    {\r\n        // Get current joint angle based on transform\r\n        switch (jointType)\r\n        {\r\n            case JointType.Revolute:\r\n                return transform.localEulerAngles.z * Mathf.Deg2Rad;\r\n            case JointType.Prismatic:\r\n                return transform.localPosition.x; // or appropriate axis\r\n            default:\r\n                return 0f;\r\n        }\r\n    }\r\n\r\n    public float GetCurrentVelocity()\r\n    {\r\n        // Calculate or store velocity\r\n        return currentVelocity;\r\n    }\r\n\r\n    public float GetCurrentEffort()\r\n    {\r\n        // Return current effort/torque\r\n        return currentEffort;\r\n    }\r\n}\r\n\r\npublic enum JointType\r\n{\r\n    Revolute,\r\n    Prismatic,\r\n    Fixed,\r\n    Continuous\r\n}\n'})}),"\n",(0,o.jsx)(r.h3,{id:"message-publishing-from-simulation",children:"Message Publishing from Simulation"}),"\n",(0,o.jsx)(r.p,{children:"The process of publishing sensor data from simulation to ROS2 involves:"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Data Collection"}),": Gather sensor data from the simulation environment"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Message Construction"}),": Format the data according to ROS2 message standards"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Topic Publishing"}),": Publish the formatted messages to appropriate ROS2 topics"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Timing Management"}),": Ensure appropriate update rates for real-time performance"]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"control-integration-with-ros2",children:"Control Integration with ROS2"}),"\n",(0,o.jsx)(r.p,{children:"Control integration involves sending commands from ROS2 nodes to the simulation environment to control robot behavior."}),"\n",(0,o.jsx)(r.h3,{id:"sending-control-commands-to-simulation",children:"Sending Control Commands to Simulation"}),"\n",(0,o.jsx)(r.h4,{id:"gazebo-control-integration",children:"Gazebo Control Integration"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-xml",children:'\x3c!-- Example: ROS2 control interface configuration --\x3e\r\n\x3c!-- Joint state controller --\x3e\r\n<gazebo>\r\n  <plugin name="joint_state_controller" filename="libgazebo_ros_joint_state_publisher.so">\r\n    <update_rate>30</update_rate>\r\n    <joint_name>hip_joint</joint_name>\r\n    <joint_name>knee_joint</joint_name>\r\n    <joint_name>ankle_joint</joint_name>\r\n  </plugin>\r\n</gazebo>\r\n\r\n\x3c!-- Position joint controller --\x3e\r\n<gazebo>\r\n  <plugin name="position_joint_controller" filename="libgazebo_ros_joint_pose.so">\r\n    <robotNamespace>/humanoid_robot</robotNamespace>\r\n    <serviceName>set_joint_positions</serviceName>\r\n    <commandTopic>joint_position_command</commandTopic>\r\n    <stateTopic>joint_position_state</stateTopic>\r\n  </plugin>\r\n</gazebo>\r\n\r\n\x3c!-- Velocity joint controller --\x3e\r\n<gazebo>\r\n  <plugin name="velocity_joint_controller" filename="libgazebo_ros_joint_trajectory.so">\r\n    <robotNamespace>/humanoid_robot</robotNamespace>\r\n    <commandTopic>joint_trajectory</commandTopic>\r\n    <stateTopic>joint_trajectory_state</stateTopic>\r\n  </plugin>\r\n</gazebo>\n'})}),"\n",(0,o.jsx)(r.h4,{id:"control-node-implementation",children:"Control Node Implementation"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-cpp",children:'// Example: ROS2 control node for simulation\r\n#include <rclcpp/rclcpp.hpp>\r\n#include <sensor_msgs/msg/joint_state.hpp>\r\n#include <trajectory_msgs/msg/joint_trajectory.hpp>\r\n#include <control_msgs/msg/joint_trajectory_controller_state.hpp>\r\n#include <std_msgs/msg/float64_multi_array.hpp>\r\n\r\nclass SimulationController : public rclcpp::Node\r\n{\r\npublic:\r\n    SimulationController()\r\n    : Node("simulation_controller")\r\n    {\r\n        // Subscribers\r\n        joint_state_sub_ = this->create_subscription<sensor_msgs::msg::JointState>(\r\n            "/joint_states", 10,\r\n            std::bind(&SimulationController::jointStateCallback, this, std::placeholders::_1));\r\n\r\n        // Publishers\r\n        joint_trajectory_pub_ = this->create_publisher<trajectory_msgs::msg::JointTrajectory>(\r\n            "/joint_trajectory", 10);\r\n\r\n        joint_command_pub_ = this->create_publisher<std_msgs::msg::Float64MultiArray>(\r\n            "/position_commands", 10);\r\n\r\n        // Timer for control loop\r\n        control_timer_ = this->create_wall_timer(\r\n            std::chrono::milliseconds(10), // 100 Hz\r\n            std::bind(&SimulationController::controlLoop, this));\r\n\r\n        RCLCPP_INFO(this->get_logger(), "Simulation controller initialized");\r\n    }\r\n\r\nprivate:\r\n    void jointStateCallback(const sensor_msgs::msg::JointState::SharedPtr msg)\r\n    {\r\n        current_joint_states_ = *msg;\r\n    }\r\n\r\n    void controlLoop()\r\n    {\r\n        // Example: Simple PD controller for maintaining a target position\r\n        if (current_joint_states_.name.empty()) {\r\n            return;\r\n        }\r\n\r\n        // Define target positions\r\n        std::vector<double> target_positions = {0.1, -0.5, 0.2}; // hip, knee, ankle\r\n        std::vector<double> current_positions;\r\n\r\n        // Extract current positions\r\n        for (const auto& joint_name : joint_names_) {\r\n            auto it = std::find(current_joint_states_.name.begin(),\r\n                              current_joint_states_.name.end(), joint_name);\r\n            if (it != current_joint_states_.name.end()) {\r\n                size_t index = std::distance(current_joint_states_.name.begin(), it);\r\n                if (index < current_joint_states_.position.size()) {\r\n                    current_positions.push_back(current_joint_states_.position[index]);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (current_positions.size() == target_positions.size()) {\r\n            // Calculate control commands\r\n            std::vector<double> commands = computePDControl(target_positions, current_positions);\r\n\r\n            // Publish position commands\r\n            publishPositionCommands(commands);\r\n        }\r\n    }\r\n\r\n    std::vector<double> computePDControl(const std::vector<double>& targets,\r\n                                       const std::vector<double>& current)\r\n    {\r\n        std::vector<double> commands;\r\n        for (size_t i = 0; i < targets.size(); ++i) {\r\n            double error = targets[i] - current[i];\r\n            double command = kp_ * error; // Simple P control\r\n            commands.push_back(command);\r\n        }\r\n        return commands;\r\n    }\r\n\r\n    void publishPositionCommands(const std::vector<double>& commands)\r\n    {\r\n        auto msg = std_msgs::msg::Float64MultiArray();\r\n        msg.data.resize(commands.size());\r\n        std::copy(commands.begin(), commands.end(), msg.data.begin());\r\n\r\n        joint_command_pub_->publish(msg);\r\n    }\r\n\r\n    rclcpp::Subscription<sensor_msgs::msg::JointState>::SharedPtr joint_state_sub_;\r\n    rclcpp::Publisher<trajectory_msgs::msg::JointTrajectory>::SharedPtr joint_trajectory_pub_;\r\n    rclcpp::Publisher<std_msgs::msg::Float64MultiArray>::SharedPtr joint_command_pub_;\r\n    rclcpp::TimerBase::SharedPtr control_timer_;\r\n\r\n    sensor_msgs::msg::JointState current_joint_states_;\r\n    std::vector<std::string> joint_names_ = {"hip_joint", "knee_joint", "ankle_joint"};\r\n    double kp_ = 10.0; // Proportional gain\r\n};\r\n\r\nint main(int argc, char * argv[])\r\n{\r\n    rclcpp::init(argc, argv);\r\n    rclcpp::spin(std::make_shared<SimulationController>());\r\n    rclcpp::shutdown();\r\n    return 0;\r\n}\n'})}),"\n",(0,o.jsx)(r.h4,{id:"unity-control-integration",children:"Unity Control Integration"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-csharp",children:'// Example: Unity control receiver for ROS2 commands\r\nusing UnityEngine;\r\nusing Unity.Robotics.ROSTCPConnector;\r\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Std;\r\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Sensor;\r\nusing Unity.Robotics.ROSTCPConnector.MessageTypes.Geometry;\r\n\r\npublic class UnityControlReceiver : MonoBehaviour\r\n{\r\n    [Header("Control Topics")]\r\n    public string jointTrajectoryTopic = "/joint_trajectory";\r\n    public string jointCommandTopic = "/position_commands";\r\n    public string cmdVelTopic = "/cmd_vel";\r\n\r\n    private ROSConnection ros;\r\n    private HumanoidRobotController robotController;\r\n\r\n    void Start()\r\n    {\r\n        ros = ROSConnection.GetOrCreateInstance();\r\n        robotController = GetComponent<HumanoidRobotController>();\r\n\r\n        // Subscribe to control topics\r\n        ros.Subscribe<JointTrajectoryMsg>(jointTrajectoryTopic, OnJointTrajectoryReceived);\r\n        ros.Subscribe<Float64MultiArrayMsg>(jointCommandTopic, OnJointCommandReceived);\r\n        ros.Subscribe<TwistMsg>(cmdVelTopic, OnVelocityCommandReceived);\r\n    }\r\n\r\n    void OnJointTrajectoryReceived(JointTrajectoryMsg trajectory)\r\n    {\r\n        if (trajectory.points.Length > 0)\r\n        {\r\n            var targetPoint = trajectory.points[0];\r\n\r\n            // Send joint positions to robot controller\r\n            if (robotController != null)\r\n            {\r\n                robotController.SetJointPositions(targetPoint.positions);\r\n            }\r\n        }\r\n    }\r\n\r\n    void OnJointCommandReceived(Float64MultiArrayMsg command)\r\n    {\r\n        // Direct position commands\r\n        if (robotController != null)\r\n        {\r\n            double[] positions = command.data;\r\n            float[] floatPositions = new float[positions.Length];\r\n\r\n            for (int i = 0; i < positions.Length; i++)\r\n            {\r\n                floatPositions[i] = (float)positions[i];\r\n            }\r\n\r\n            robotController.SetJointPositions(floatPositions);\r\n        }\r\n    }\r\n\r\n    void OnVelocityCommandReceived(TwistMsg twist)\r\n    {\r\n        // Handle velocity commands for mobile base\r\n        if (robotController != null)\r\n        {\r\n            robotController.SetVelocityCommand(\r\n                (float)twist.linear.x,\r\n                (float)twist.linear.y,\r\n                (float)twist.linear.z,\r\n                (float)twist.angular.x,\r\n                (float)twist.angular.y,\r\n                (float)twist.angular.z\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\n// Enhanced robot controller with ROS2 integration\r\npublic class HumanoidRobotController : MonoBehaviour\r\n{\r\n    [Header("Joint Configuration")]\r\n    public HumanoidJoint[] joints;\r\n\r\n    [Header("Control Parameters")]\r\n    public float positionKp = 10.0f;\r\n    public float velocityKp = 5.0f;\r\n    public float maxVelocity = 2.0f;\r\n\r\n    private float[] targetPositions;\r\n    private float[] currentPositions;\r\n\r\n    void Start()\r\n    {\r\n        InitializeJoints();\r\n        targetPositions = new float[joints.Length];\r\n        currentPositions = new float[joints.Length];\r\n    }\r\n\r\n    void InitializeJoints()\r\n    {\r\n        // Find all joint components\r\n        joints = GetComponentsInChildren<HumanoidJoint>();\r\n    }\r\n\r\n    void Update()\r\n    {\r\n        UpdateControl();\r\n    }\r\n\r\n    void UpdateControl()\r\n    {\r\n        // Update current positions\r\n        for (int i = 0; i < joints.Length; i++)\r\n        {\r\n            currentPositions[i] = joints[i].GetCurrentAngle();\r\n        }\r\n\r\n        // Apply control to reach target positions\r\n        ApplyPositionControl();\r\n    }\r\n\r\n    void ApplyPositionControl()\r\n    {\r\n        for (int i = 0; i < joints.Length && i < targetPositions.Length; i++)\r\n        {\r\n            float error = targetPositions[i] - currentPositions[i];\r\n            float command = positionKp * error;\r\n\r\n            // Apply velocity limit\r\n            command = Mathf.Clamp(command, -maxVelocity, maxVelocity);\r\n\r\n            // Apply command to joint\r\n            joints[i].ApplyVelocityCommand(command);\r\n        }\r\n    }\r\n\r\n    public void SetJointPositions(float[] positions)\r\n    {\r\n        // Validate input\r\n        if (positions.Length != targetPositions.Length)\r\n        {\r\n            Debug.LogWarning($"Position array size mismatch: expected {targetPositions.Length}, got {positions.Length}");\r\n            return;\r\n        }\r\n\r\n        // Set target positions\r\n        for (int i = 0; i < positions.Length; i++)\r\n        {\r\n            targetPositions[i] = positions[i];\r\n        }\r\n    }\r\n\r\n    public void SetVelocityCommand(float linearX, float linearY, float linearZ,\r\n                                 float angularX, float angularY, float angularZ)\r\n    {\r\n        // Handle mobile base velocity commands\r\n        // Implementation depends on robot base type\r\n        Rigidbody rb = GetComponent<Rigidbody>();\r\n        if (rb != null)\r\n        {\r\n            rb.velocity = new Vector3(linearX, linearY, linearZ);\r\n            rb.angularVelocity = new Vector3(angularX, angularY, angularZ);\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,o.jsx)(r.h2,{id:"safety-and-error-handling",children:"Safety and Error Handling"}),"\n",(0,o.jsx)(r.p,{children:"When integrating simulation with ROS2, safety and error handling are crucial for reliable operation:"}),"\n",(0,o.jsxs)(r.ol,{children:["\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Connection Monitoring"}),": Continuously monitor connection status between systems"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Graceful Degradation"}),": Implement fallback behaviors when communication fails"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Command Validation"}),": Validate all incoming commands before execution"]}),"\n",(0,o.jsxs)(r.li,{children:[(0,o.jsx)(r.strong,{children:"Emergency Stop"}),": Implement emergency stop functionality for safety"]}),"\n"]}),"\n",(0,o.jsx)(r.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsx)(r.p,{children:"The integration of simulation environments with ROS2 enables powerful workflows for developing, testing, and validating humanoid robots. The ROS2-Gazebo and ROS2-Unity bridges provide robust communication channels that allow for sophisticated sensor simulation, control implementation, and real-time validation. Proper integration ensures that the digital twin accurately reflects the intended physical system behavior, enabling effective transfer of validated behaviors from simulation to reality."})]})}function d(n={}){const{wrapper:r}={...(0,i.R)(),...n.components};return r?(0,o.jsx)(r,{...n,children:(0,o.jsx)(m,{...n})}):m(n)}},8453(n,r,e){e.d(r,{R:()=>a,x:()=>s});var t=e(6540);const o={},i=t.createContext(o);function a(n){const r=t.useContext(i);return t.useMemo(function(){return"function"==typeof n?n(r):{...r,...n}},[r,n])}function s(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:a(n.components),t.createElement(i.Provider,{value:r},n.children)}}}]);